<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="cordinc">
    <title>Quick Timezone Calculation</title>
    <link href="/assets/css/bootstrap.css" rel="stylesheet">
    <link href="/assets/css/cordinc.css" rel="stylesheet">
    <link href="/assets/css/pygments/default.css" rel="stylesheet">
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Cordinc</a>
        <div class="nav-collapse collapse">
          <ul class="nav navbar-nav">
            <li class=""><a href="/about.html">About</a></li>
            <li class=""><a href="/projects">Projects</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">

       <div class="cordinc-content">
            <div class="row">
<div class="col-lg-8">
<b>December 13, 2008</b>
<h4>Quick Timezone Calculation</h4>
Tags: 
    
      <a class="post" href="/blog/tag/Ruby.html">Ruby</a>, 
    
      <a class="post" href="/blog/tag/Technical.html">Technical</a>
    
<br/><br/>
<p>I have been asked what time I get the forecasts for a location in my
<a href="http://www.cordinc.info/weather/">historical weather forecast system</a>.
The obvious problem being that if I read all the forecasts at nearly the
same time, different cities could be in different days due to differing
timezones.</p>

<p>The answer is, I read the forecasts at roughly midday in each of the
locations. That is, every hour I read the forecasts for the locations
where it is roughly midday. This is done by approximating the various
<a href="http://en.wikipedia.org/wiki/Time_zone">timezones</a> using the location’s
longitude. This isn’t exact - it doesn’t account for daylight savings or
places like China, which is all one timezone despite being wide enough
to be split into many. Generally it is accurate to within a couple of
hours - fine for the purpose. The code is below.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">time_band</span> <span class="o">=</span> <span class="o">-</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">gmtime</span><span class="p">.</span><span class="nf">hour</span> <span class="o">+</span> <span class="mi">12</span>
<span class="n">locs</span> <span class="o">=</span> <span class="no">Location</span><span class="p">.</span><span class="nf">find_by_sql</span> <span class="p">[</span><span class="s2">"select * from locations where longitude &gt;= ? and longitude &lt; ?"</span><span class="p">,</span> <span class="p">(</span><span class="n">time_band</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">15</span><span class="p">,</span> <span class="n">time_band</span><span class="o">*</span><span class="mi">15</span><span class="p">]</span></code></pre></figure>


</div>

<div class="col-lg-2">
<br/>

<small>
<a href="/blog/archives.html">Full Archives</a>

<br/><br/>

Recent Posts:
<ul class="list-unstyled">
  
  <li>  
    <a href="/blog/2023/02/boardgames.html">Boardgames of 2022</a> 
  </li>  
  
  <li>  
    <a href="/blog/2023/02/15-years.html">15 years</a> 
  </li>  
  
  <li>  
    <a href="/blog/2023/02/goals.html">Goals</a> 
  </li>  
  
  <li>  
    <a href="/blog/2022/12/release.html">Release</a> 
  </li>  
  
  <li>  
    <a href="/blog/2022/10/back-again-gaming.html">Back Again Gaming</a> 
  </li>  
  
  <li>  
    <a href="/blog/2022/09/hosting.html">Hosting</a> 
  </li>  
  
  <li>  
    <a href="/blog/2022/08/roguelike.html">Roguelike Tutorial 2022</a> 
  </li>  
  
  <li>  
    <a href="/blog/2022/06/brisbane.html">Brisbane</a> 
  </li>  
  
  <li>  
    <a href="/blog/2022/06/ipod.html">iPod</a> 
  </li>  
  
  <li>  
    <a href="/blog/2022/04/esperance.html">Esperance (and places along the way)</a> 
  </li>  

</ul>

<br/><br/>

Top Tags: <ul class="list-unstyled"><li><a href="/blog/tag/Technical.html">Technical</a></li> <li><a href="/blog/tag/A%20Gamedev%20Plays.html">A Gamedev Plays</a></li> <li><a href="/blog/tag/Games.html">Games</a></li> <li><a href="/blog/tag/Travel.html">Travel</a></li> <li><a href="/blog/tag/History.html">History</a></li> <li><a href="/blog/tag/Podcasts.html">Podcasts</a></li> <li><a href="/blog/tag/General.html">General</a></li> <li><a href="/blog/tag/Memories.html">Memories</a></li> <li><a href="/blog/tag/Video%20Games.html">Video Games</a></li> <li><a href="/blog/tag/Finance.html">Finance</a></li> <li><a href="/blog/tag/Projects.html">Projects</a></li> <li><a href="/blog/tag/Meta.html">Meta</a></li> <li><a href="/blog/tag/Malaysia.html">Malaysia</a></li> <li><a href="/blog/tag/Java.html">Java</a></li> <li><a href="/blog/tag/Goals.html">Goals</a></li></ul>

</small>
</div>

<div class="col-lg-2">
</div>
</div>

       </div>

    </div><!-- /.container -->

  </body>
</html>
